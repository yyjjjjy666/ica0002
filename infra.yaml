---
  - name: Collect information about all VMs
    hosts: all
    become: yes
    tasks:
      - setup:

  - name: Init
    hosts: all 
    become: yes
    roles:
      - init
      - backup

  - name: Setup DB Server
    hosts: 
      - db_servers
    become: yes
    roles:
      - mysql
      - mysql_backup

  - name: Setup Web Server
    hosts: 
      - web_servers
    become: yes
    roles:
      - agama
      - uwsgi

  - name: Install and configure Nginx
    hosts: all
    become: yes
    roles: 
      - nginx
      - nginx_exporter

  - name: Configure DNS Server
    hosts: 
      - dns_servers
    become: yes
    roles:
      - bind
      - bind_exporter

  - name: Install node exporters
    hosts: all
    become: yes
    roles:
      - node_exporter

  - name: Install and configure prometheus
    hosts: 
      - prometheus_server
    become: yes
    roles:
      - prometheus

  - name: Setup DB Server backup
    hosts: 
      - db_servers
    become: yes
    roles:
      - mysql_exporter

  - name: grafana
    hosts: 
      - grafana
    become: yes
    roles:
      - grafana

  - name: DNS resolver
    hosts: all
    become: yes
    roles:
      - dns_resolve

  - name: install InfluxDB and telegraf
    hosts: 
      - influxdb
    become: yes
    roles:
      - influxdb
      - influxdb_exporter
      - influxdb_backup

  - name: configure rsyslog
    hosts: all
    become: yes
    roles:
      - rsyslog

  - name: transfer and setup pinger sciprt
    hosts: 
      - pinger
    become: yes
    roles:
      - pinger