---
#  - name: Collect information about all VMs
#    hosts: all
#    become: yes
#    tasks:
#      - setup:

  - name: Init
    hosts: all 
    become: yes
    roles:
      - init

  - name: Setup Web Server
    hosts: 
      - web_servers
    become: yes
    roles:
      - agama
      - uwsgi

  - name: Setup DB Server
    hosts: 
      - db_servers
    become: yes
    roles:
      - mysql

  - name: install InfluxDB and telegraf
    hosts: 
      - influxdb
    become: yes
    roles:
      - influxdb

  - name: Configure DNS Server
    hosts: 
      - dns_servers
    become: yes
    roles:
      - bind
      - bind_exporter

  - name: Install and configure prometheus
    hosts: 
      - prometheus_server
    become: yes
    roles:
      - prometheus

  - name: All machines
    hosts: all 
    become: yes
    roles:
      - dns_resolve
      - backup
      - nginx
      - nginx_exporter
      - rsyslog
      - node_exporter

  - name: grafana
    hosts: 
      - grafana
    become: yes
    roles:
      - grafana

  - name: transfer and setup pinger sciprt
    hosts: 
      - pinger
    become: yes
    roles:
      - pinger

  - name: Setup DB Server backup
    hosts: 
      - db_servers
    become: yes
    roles:
      - mysql_exporter
      - mysql_backup

  - name: configure influx exp and backup
    hosts: 
      - influxdb
    become: yes
    roles:
      - influxdb_exporter
      - influxdb_backup
