---
  - name: Create a directory if it does not exist
    ansible.builtin.file:
      path: /home/backup/mysql
      state: directory
      owner: backup
      mode: '0755'

  - name: Create MySQL user backup
    community.mysql.mysql_user:
      name: "{{ mysql_backup_user }}"
      password: "{{ mysql_backup_password }}"
      priv: "agama.*:LOCK TABLES,SELECT"
      login_unix_socket: /var/run/mysqld/mysqld.sock

  - name: cnf file
    template:
      src: .my.cnf.j2
      dest: /home/backup/.my.cnf
      mode: '0700'
    notify: Restart mysql service
